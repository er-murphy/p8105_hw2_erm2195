---
title: "P8105 Homework 2"
output: github_document
date: "2023-10-02"
---

# Problem 1
Goal: merging the FiveThirtyEight `pols-month.csv`, `unemployment.csv`, and `snp.csv` data into a single data frame using year and month as keys across datasets.

## Loading Libraries
First, loading the `tidyverse` and `readxl` libraries for use throughout the homework.
```{r library}
library(tidyverse)
library(readxl)
```

## Cleaning `pols-month` Data
Now, cleaning the data in `pols-month.csv`:

* Using separate() to break up the variable `mon` into integer variables `year`, `month`, and `day`
* Replacing month number with month name
* Creating a `president` variable taking values "gop" and "dem"
* Removing `prez_dem` and `prez_gop` variables
* Removing the `day` variable

```{r cleaning_pols}

pols = 
  read_csv("Data/pols-month.csv") |> 
  janitor::clean_names() |> 
  separate(mon, into = c("year", "month", "day"), sep = "-") |> 
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day),
    president = ifelse(prez_dem > 0 , "dem", "gop"),
    month = case_match(month,
      1 ~ "January",
      2 ~ "February",
      3 ~ "March",
      4 ~ "April",
      5 ~ "May",
      6 ~ "June",
      7 ~ "July",
      8 ~ "August",
      9 ~ "September",
      10 ~ "October",
      11 ~ "November",
      12 ~ "December")
  ) |> 
  select(-starts_with("prez"), -day)

```

## Cleaning `snp` Data
Second, cleaning the data in `snp.csv` using a similar process:

* Using separate() to break up the variable `date` into integer variables `year`, `month`, and `day`
* Converting the `year` variable into a 4 digit value
* Replacing month number with month name
* Reorganizing so that year and month are the leading columns
* Removing the `day` variable

```{r cleaning_snp}
snp = 
  read_csv("Data/snp.csv") |> 
  janitor::clean_names() |> 
  separate(date, into = c("month", "day", "year"), sep = "/") |> 
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day),
    year = ifelse(as.integer(year) < 24, as.integer(year) + 2000, as.integer(year) + 1900),
    month = case_match(month,
      1 ~ "January",
      2 ~ "February",
      3 ~ "March",
      4 ~ "April",
      5 ~ "May",
      6 ~ "June",
      7 ~ "July",
      8 ~ "August",
      9 ~ "September",
      10 ~ "October",
      11 ~ "November",
      12 ~ "December")
  ) |> 
  select(year, month, close)

```

## Cleaning `unemployment` Data
Third, tidying the data in `unemployment.csv` so that it can be merged with the other two datasets:

* Switch from "wide" to "long" format - turn months into a single column, and the value of existing `months` column into a column called `unemployment`
* Converting month names to capitalized full names to match the format of other datasets

```{r cleaning_unemployment}
unemployment = 
  read_csv("Data/unemployment.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(jan:dec, names_to = "month", values_to = "unemployment") |> 
  mutate(
    month = case_match(month,
    "jan" ~ "January",
    "feb" ~ "February",
    "mar" ~ "March",
    "apr" ~ "April",
    "may" ~ "May",
    "jun" ~ "June",
    "jul" ~ "July",
    "aug" ~ "August",
    "sep" ~ "September",
    "oct" ~ "October",
    "nov" ~ "November",
    "dec" ~ "December")
  )
```

## Merging the Data Sets
Joining the datasets by merging `snp` into `pols`, and then merging `unemployment` into the result. The resulting dataset is called `data_538`
```{r merging_pols_snp_unemployment}

data_538 = left_join(pols, snp) |> 
  left_join(x = _, y = unemployment)

str(data_538)
```

## Description of the Combined Data Set
The `pols` data set has `r nrow(pols)` observations and `r ncol(pols)` variables. It details the party affiliation distribution (democrat or republican) for governors and senators in a given year from `r pols |> pull(year) |> min()` to `r pols |> pull(year) |> max()`. It also specifies the political party of the president at that time. The `snp` data has `r nrow(snp)` observations and `r ncol(snp)` variables, and contains the closing value of the S&P index on the associated date. The included dates range from `r snp |> pull(year) |> min()` to `r snp |> pull(year) |> max()`. The `unemployment` data has `r nrow(unemployment)` observations and `r ncol(unemployment)` variables, and contains the percentage of unemployment on the associated date, ranging from years `r unemployment |> pull(year) |> min()` to `r unemployment |> pull(year) |> max()`. 

From the merged `538_data` data set we can see that in January from 1975 onward, in years with a democratic president, the average unemployment rate was `r filter(data_538, month == "January", year >= 1975, president == "dem") |> pull(unemployment) |> mean() |> round(2)`. For comparison, the average unemployment rate over the same time period in which a republican was president was `r filter(data_538, month == "January", year >= 1975, president == "gop") |> pull(unemployment) |> mean() |> round(2)`.


# Problem 2

## Cleaning `Mr. Trash Wheel` Data
First, reading in and cleaning the data from the Excel file sheet `Mr. Trash Wheel`:

* Specifying the sheet in the Excel file
* Using arguments in `read_excel`, omitting non-data entries like rows with figures and columns containing notes. For the 2023 Mr. Trash Data, this is the first row and the `Homes` column
* Specifying reasonable variable names. I think that the names imported from the Excel document are already pretty reasonable. For the sake of brevity, dropping the units from weight and volume (as I would just document these units elsewhere, rather than in the variable name itself)
* Omitting rows that don't include dumpster-specific data > removing the last row, which is a sum count of column values
* Creating a `homes_powered` for the approximate number of homes powered, based on the calculation described in the Homes powered note

Note: Rather than specifying the columns to import in the read_excel statement, I think it makes more sense to import them all and then just drop the Homes column specifically. That way, this code will still work if additional columns are added in future years. But, doing it this way as the question specified that we should omit columns with non-data entries within the arguments of `read_excel`.

```{r cleaning_mister}
mister = 
  read_excel("Data/202309 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", range = cell_cols("A:M"), skip = 1, col_names = TRUE) |> 
  janitor::clean_names() |> 
  drop_na(dumpster) |> 
  rename(weight = weight_tons, volume = volume_cubic_yards) |>
  mutate(
    homes_powered = (weight * 500) / 30
  )
```

## Cleaning `Professor Trash Wheel` Data
Next, similarly reading in and cleaning the data from the Excel file sheet `Professor Trash Wheel`:

* Specifying the sheet in the Excel file
* Using arguments in `read_excel`, omitting non-data entries like rows with figures and columns containing notes. As with the Mr. Trash Data, this is the first row and the `Homes` column
* Specifying reasonable variable names. I think that the names imported from the Excel document are already pretty reasonable. For the sake of brevity, dropping the units from weight and volume (as I would just document these units elsewhere, rather than in the variable name itself)
* Omitting rows that don't include dumpster-specific data > removing the last row, which is a sum count of column values
* Creating a `homes_powered` for the approximate number of homes powered, based on the calculation described in the Homes powered note


```{r cleaning_professor}
professor = 
  read_excel("Data/202309 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", range = cell_cols("A:L"), skip = 1, col_names = TRUE) |>
  janitor::clean_names() |> 
  drop_na(dumpster) |> 
  rename(weight = weight_tons, volume = volume_cubic_yards) |> 
  mutate(
    homes_powered = (weight * 500) / 30
  )
```

## Cleaning `Gwynnda Trash Wheel` Data
Next, similarly reading in and cleaning the data from the Excel file sheet `Gwynnda Trash Wheel`:

* Specifying the sheet in the Excel file
* Using arguments in `read_excel`, omitting non-data entries like rows with figures and columns containing notes. As with the Mr. Trash Data, this is the first row and the `Homes` column
* Specifying reasonable variable names. I think that the names imported from the Excel document are already pretty reasonable. For the sake of brevity, dropping the units from weight and volume (as I would just document these units elsewhere, rather than in the variable name itself)
* Omitting rows that don't include dumpster-specific data
* Create a `homes_powered` for the approximate number of homes powered, based on the calculation described in the Homes powered note

```{r cleaning_gywnnda}
gwynnda = 
  read_excel("Data/202309 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel", range = cell_cols("A:L"), skip = 1, col_names = TRUE) |>
  janitor::clean_names() |> 
  drop_na(dumpster) |> 
  rename(weight = weight_tons, volume = volume_cubic_yards) |> 
  mutate(
    homes_powered = (weight * 500) / 30
  )
```

## Merging the Datasets

Now, adding a column to each dataset to identify the dataset name (to help with identification post-merge). Then, combining the `professor` and `gwynnda` datasets with the `mister` dataset to produce a single dataset.
```{r}
mister = mutate(mister, dataset = "mister")
professor = mutate(professor, dataset = "professor")
gwynnda = mutate(gwynnda, dataset = "gwynnda")
```




Use a similar process to import, clean, and organize the data for Professor Trash Wheel and Gwynnda, and combine these with the Mr. Trash Wheel dataset to produce a single tidy dataset. To keep track of which Trash Wheel is which, you may need to add an additional variable to all datasets before combining.

Write a paragraph about these data; you are encouraged to use inline R. Be sure to note the number of observations in the resulting dataset, and give examples of key variables. For available data, what was the total weight of trash collected by Professor Trash Wheel? What was the total number of cigarette butts collected by Gwynnda in July of 2021?


# Questions
Questions to return to if have time before homework submission:

* More flexible way to skip the first row, last row, and right-most column when importing the Mr. Trash Wheel data?
